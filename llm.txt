# Clari API - LLM Documentation
# API ë³€ê²½ì‚¬í•­ ë° ì „ì²´ ìŠ¤í™ (2025-12-30)

## ğŸ“‹ ëª©ì°¨
1. [ìƒˆë¡œ ì¶”ê°€ëœ ê¸°ëŠ¥](#ìƒˆë¡œ-ì¶”ê°€ëœ-ê¸°ëŠ¥)
2. [User ëª¨ë¸ ë³€ê²½](#user-ëª¨ë¸-ë³€ê²½)
3. [KeywordPack ê¸°ëŠ¥ í™•ì¥](#keywordpack-ê¸°ëŠ¥-í™•ì¥)
4. [Note AI ì„¤ëª… ê¸°ëŠ¥](#note-ai-ì„¤ëª…-ê¸°ëŠ¥)
5. [STT ì „ì²˜ë¦¬ ì‹œìŠ¤í…œ](#stt-ì „ì²˜ë¦¬-ì‹œìŠ¤í…œ)
6. [ì „ì²´ API ì—”ë“œí¬ì¸íŠ¸](#ì „ì²´-api-ì—”ë“œí¬ì¸íŠ¸)

---

## ğŸ†• ìƒˆë¡œ ì¶”ê°€ëœ ê¸°ëŠ¥

### 1. ì‚¬ìš©ì ì—­í• (Role) ë° í™œì„±í™” ì‹œìŠ¤í…œ
- Google OAuth ë¡œê·¸ì¸ ì‹œ ìë™ íšŒì›ê°€ì… (isActive: false)
- `/auth/register/continue`ë¡œ ì—­í•  ì„¤ì • í›„ í™œì„±í™”
- ë¹„í™œì„± ì‚¬ìš©ìëŠ” ëŒ€ë¶€ë¶„ì˜ API ì ‘ê·¼ ë¶ˆê°€ (403 Forbidden)

### 2. KeywordPack í•œê¸€ ë°œìŒ & ë™ì˜ì–´ ì‹œìŠ¤í…œ
- ì˜ì–´ ë‹¨ì–´ì˜ í•œê¸€ ë°œìŒ ìë™ ìƒì„±
- ë™ì˜ì–´(synonyms) ìë™ ìƒì„± ë° ë§¤í•‘
- STT ì‹¤ì‹œê°„ ì „ì²˜ë¦¬ë¡œ "ì—ì´í”¼ì•„ì´" â†’ "API" ìë™ ë³€í™˜

### 3. KeywordPack Cloud Save
- ê³µê°œ KeywordPack ì €ì¥ ê¸°ëŠ¥
- ë³µì œ ì—†ì´ ì°¸ì¡°ë§Œ ì €ì¥ (savedKeywordPackIds)
- isOwned/isSaved í”Œë˜ê·¸ë¡œ ì†Œìœ /ì €ì¥ êµ¬ë¶„

### 4. Note AI ì„¤ëª… ê¸°ëŠ¥
- íŠ¹ì • ë¬¸ì¥ì— ëŒ€í•œ ë§¥ë½ ê¸°ë°˜ AI ì„¤ëª…
- ì‚¬ìš©ì roleì— ë”°ë¥¸ ë§ì¶¤í˜• ì„¤ëª… ìƒì„±
- ì „ì²´ transcriptë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ í™œìš©

---

## ğŸ‘¤ User ëª¨ë¸ ë³€ê²½

### Schema
```prisma
model User {
  id                    String   @id @default(uuid())
  email                 String   @unique
  name                  String?
  googleId              String?  @unique
  profileUrl            String?
  role                  String?  // ìƒˆë¡œ ì¶”ê°€: ì‚¬ìš©ì ì—­í•  (ììœ  ë¬¸ìì—´)
  isActive              Boolean  @default(false) // ìƒˆë¡œ ì¶”ê°€: í™œì„±í™” ì—¬ë¶€
  savedKeywordPackIds   String[] @default([]) // ìƒˆë¡œ ì¶”ê°€: ì €ì¥í•œ ê³µê°œ KeywordPack ID ëª©ë¡
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}
```

### í•„ë“œ ì„¤ëª…
- **role**: ììœ  ë¬¸ìì—´ (ì˜ˆ: "student", "teacher", "admin", "ê°œë°œì" ë“±)
  - AI ì„¤ëª… ìƒì„± ì‹œ ì°¸ê³ ìš©
  - student: ì´ˆë³´ì ìˆ˜ì¤€ ì„¤ëª…
  - teacher: êµìœ¡í•™ì  ê´€ì  ì„¤ëª…
  - ê¸°íƒ€: ì¼ë°˜ì ì¸ ì„¤ëª…

- **isActive**: íšŒì›ê°€ì… ì™„ë£Œ ì—¬ë¶€
  - false: ì—­í•  ì„ íƒ ì „ (ëŒ€ë¶€ë¶„ API ì ‘ê·¼ ë¶ˆê°€)
  - true: íšŒì›ê°€ì… ì™„ë£Œ (ëª¨ë“  API ì‚¬ìš© ê°€ëŠ¥)

- **savedKeywordPackIds**: ì €ì¥í•œ ê³µê°œ KeywordPack ID ë°°ì—´
  - ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ê³µê°œ íŒ©ì„ ì €ì¥í•  ë•Œ ì‚¬ìš©
  - ë³µì œ ì—†ì´ ì°¸ì¡°ë§Œ ì €ì¥

---

## ğŸ” ì¸ì¦(Auth) API

### 1. Google OAuth ë¡œê·¸ì¸
```http
POST /api/auth/google
Content-Type: application/json

{
  "idToken": "google-id-token"
}
```

**Response:**
```json
{
  "accessToken": "jwt-token",
  "user": {
    "id": "uuid",
    "email": "user@example.com",
    "name": "User Name",
    "profileUrl": "https://...",
    "role": null,
    "isActive": false  // âš ï¸ ë¹„í™œì„± ìƒíƒœ
  }
}
```

**ë™ì‘:**
- ì²« ë¡œê·¸ì¸: User ìƒì„± (isActive: false)
- ì¬ë¡œê·¸ì¸: ê¸°ì¡´ User ì¡°íšŒ
- JWT í† í° ë°œê¸‰

### 2. íšŒì›ê°€ì… ì™„ë£Œ (NEW)
```http
POST /api/auth/register/continue
Authorization: Bearer <token>
Content-Type: application/json

{
  "role": "student",  // í•„ìˆ˜
  "name": "ìƒˆ ì´ë¦„"   // ì„ íƒ
}
```

**Response:**
```json
{
  "user": {
    "id": "uuid",
    "email": "user@example.com",
    "name": "ìƒˆ ì´ë¦„",
    "profileUrl": "https://...",
    "role": "student",
    "isActive": true  // âœ… í™œì„±í™”ë¨
  }
}
```

**ë™ì‘:**
- role ì„¤ì •
- isActiveë¥¼ trueë¡œ ë³€ê²½
- ì´í›„ ëª¨ë“  API ì‚¬ìš© ê°€ëŠ¥

---

## ğŸ“¦ KeywordPack ëª¨ë¸ ë³€ê²½

### Schema
```prisma
model KeywordPack {
  id              String   @id @default(uuid())
  name            String
  keywords        Json     // êµ¬ì¡° ë³€ê²½ë¨ (ì•„ë˜ ì°¸ê³ )
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  isPublic        Boolean  @default(false)
  previewImageUrl String?
  authorId        String
}
```

### Keywords êµ¬ì¡° (ë³€ê²½ë¨)
```typescript
// ê¸°ì¡´
{
  name: string
  description: string
}

// ë³€ê²½ í›„
{
  name: string                    // í‚¤ì›Œë“œ ì´ë¦„ (ì˜ˆ: "API")
  description: string             // ì„¤ëª…
  koreanPronunciation?: string    // ìƒˆë¡œ ì¶”ê°€: í•œê¸€ ë°œìŒ (ì˜ˆ: "ì—ì´í”¼ì•„ì´")
  synonyms?: string[]             // ìƒˆë¡œ ì¶”ê°€: ë™ì˜ì–´ ëª©ë¡ (ì˜ˆ: ["Application Programming Interface"])
}
```

**ì˜ˆì‹œ:**
```json
{
  "name": "API",
  "description": "Application Programming Interface",
  "koreanPronunciation": "ì—ì´í”¼ì•„ì´",
  "synonyms": ["Application Programming Interface", "ì• í”Œë¦¬ì¼€ì´ì…˜ ì¸í„°í˜ì´ìŠ¤"]
}
```

---

## ğŸ“š KeywordPack API

### 1. ëª©ë¡ ì¡°íšŒ (ë³€ê²½ë¨)
```http
GET /api/keywordpack?limit=50
Authorization: Bearer <token>
```

**Response:**
```json
{
  "packs": [
    {
      "id": "uuid",
      "name": "ë‚´ê°€ ë§Œë“  íŒ©",
      "keywords": [...],
      "isPublic": false,
      "authorId": "my-user-id",
      "isOwned": true,   // ìƒˆë¡œ ì¶”ê°€: ë‚´ê°€ ë§Œë“  íŒ©
      "isSaved": false   // ìƒˆë¡œ ì¶”ê°€: ì €ì¥í•œ íŒ© ì—¬ë¶€
    },
    {
      "id": "uuid",
      "name": "ì €ì¥í•œ ê³µê°œ íŒ©",
      "keywords": [...],
      "isPublic": true,
      "authorId": "other-user-id",
      "isOwned": false,
      "isSaved": true    // ë‹¤ë¥¸ ì‚¬ëŒì˜ ê³µê°œ íŒ©ì„ ì €ì¥í•¨
    }
  ]
}
```

**ë³€ê²½ì‚¬í•­:**
- ë‚´ê°€ ë§Œë“  íŒ© + ì €ì¥í•œ ê³µê°œ íŒ© ëª¨ë‘ ë°˜í™˜
- `isOwned`: ë‚´ê°€ ë§Œë“  íŒ©ì¸ì§€ ì—¬ë¶€
- `isSaved`: ë‹¤ë¥¸ ì‚¬ëŒì˜ ê³µê°œ íŒ©ì„ ì €ì¥í•œ ê²ƒì¸ì§€ ì—¬ë¶€

### 2. AI Autofill (ë³€ê²½ë¨)
```http
POST /api/keywordpack/ai/autofill
Authorization: Bearer <token>
Content-Type: application/json

{
  "query": "í”„ë¡œê·¸ë˜ë° ê¸°ì´ˆ",
  "count": 50  // ì„ íƒ, ê¸°ë³¸ê°’ 50
}
```

**Response:**
```json
{
  "keywords": [
    {
      "name": "API",
      "description": "ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œê·¸ë˜ë° ì¸í„°í˜ì´ìŠ¤",
      "koreanPronunciation": "ì—ì´í”¼ì•„ì´",  // ìƒˆë¡œ ì¶”ê°€
      "synonyms": ["Application Programming Interface", "ì• í”Œë¦¬ì¼€ì´ì…˜ ì¸í„°í˜ì´ìŠ¤"]  // ìƒˆë¡œ ì¶”ê°€
    }
  ],
  "stats": {
    "perplexityTime": 1500,
    "gptTime": 2000,
    "pronunciationTime": 800,  // ìƒˆë¡œ ì¶”ê°€
    "synonymTime": 1200,        // ìƒˆë¡œ ì¶”ê°€
    "totalTime": 5500,
    "requestedCount": 50,
    "actualCount": 48,
    "withPronunciation": 35,    // ìƒˆë¡œ ì¶”ê°€
    "withSynonyms": 42          // ìƒˆë¡œ ì¶”ê°€
  }
}
```

**í”„ë¡œì„¸ìŠ¤ (4ë‹¨ê³„ë¡œ í™•ì¥):**
1. Perplexityë¡œ ê´€ë ¨ ìš©ì–´ ê²€ìƒ‰
2. GPTë¡œ í‚¤ì›Œë“œ ì¶”ì¶œ ë° í•œê¸€ ì„¤ëª… ìƒì„±
3. GPTë¡œ ì˜ì–´ ë‹¨ì–´ì˜ í•œê¸€ ë°œìŒ ìƒì„±
4. GPTë¡œ ëª¨ë“  ë‹¨ì–´ì˜ ë™ì˜ì–´ ìƒì„±

### 3. Cloud Save (NEW)
```http
POST /api/keywordpack/:id/cloud-save
Authorization: Bearer <token>
```

**Response (ì„±ê³µ):**
```json
{
  "message": "Keyword pack saved successfully",
  "pack": {
    "id": "uuid",
    "name": "ê³µê°œ í‚¤ì›Œë“œíŒ©",
    "isOwned": false,
    "isSaved": true
  }
}
```

**ì—ëŸ¬:**
- 403: Packì´ ê³µê°œë˜ì§€ ì•ŠìŒ
- 400: ìê¸° ìì‹ ì˜ packì„ ì €ì¥í•˜ë ¤ëŠ” ê²½ìš°
- 200: ì´ë¯¸ ì €ì¥ëœ ê²½ìš°

**ë™ì‘:**
- ê³µê°œ(`isPublic: true`)ëœ KeywordPackë§Œ ì €ì¥ ê°€ëŠ¥
- ìê¸° ìì‹ ì˜ íŒ©ì€ ì €ì¥ ë¶ˆê°€
- Userì˜ `savedKeywordPackIds`ì— ID ì¶”ê°€
- ì‹¤ì œ ë°ì´í„°ëŠ” ë³µì œí•˜ì§€ ì•ŠìŒ (ì°¸ì¡°ë§Œ)

### 4. Cloud Unsave (NEW)
```http
DELETE /api/keywordpack/:id/cloud-save
Authorization: Bearer <token>
```

**Response:**
```json
{
  "message": "Keyword pack removed from saved list successfully"
}
```

**ë™ì‘:**
- Userì˜ `savedKeywordPackIds`ì—ì„œ ID ì œê±°
- ì›ë³¸ ë°ì´í„°ëŠ” ìœ ì§€

---

## ğŸ“ Note API

### Note AI ì„¤ëª… (NEW)
```http
POST /api/notes/:id/ai/explanation
Authorization: Bearer <token>
Content-Type: application/json

{
  "sentence": "APIë¥¼ ì‚¬ìš©í•´ì„œ React ì•±ì„ ë§Œë“¤ê³  Dockerë¡œ ë°°í¬í–ˆìŠµë‹ˆë‹¤"
}
```

**Response:**
```json
{
  "sentence": "APIë¥¼ ì‚¬ìš©í•´ì„œ React ì•±ì„ ë§Œë“¤ê³  Dockerë¡œ ë°°í¬í–ˆìŠµë‹ˆë‹¤",
  "explanation": "**ë§¥ë½**: ì´ ë¬¸ì¥ì€ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì˜ ì „ì²´ ê³¼ì •ì„ ì„¤ëª…í•˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤.\n\n**í•µì‹¬ ì„¤ëª…**: \n- API: í”„ë¡œê·¸ë¨ë“¤ì´ ì„œë¡œ ì†Œí†µí•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ì¸í„°í˜ì´ìŠ¤\n- React: ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“œëŠ” JavaScript ë¼ì´ë¸ŒëŸ¬ë¦¬\n- Docker: ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì»¨í…Œì´ë„ˆë¡œ íŒ¨í‚¤ì§•í•˜ì—¬ ë°°í¬í•˜ëŠ” ë„êµ¬\n\n**ë³´ì¶© ì„¤ëª…**: í˜„ëŒ€ì ì¸ ì›¹ ê°œë°œì˜ í‘œì¤€ ì›Œí¬í”Œë¡œìš°ì…ë‹ˆë‹¤.",
  "context": {
    "userRole": "student",
    "noteTitle": "ì›¹ ê°œë°œ ê°•ì˜",
    "transcriptLength": 1250
  },
  "generatedAt": "2025-12-30T23:35:00.000Z"
}
```

**ë™ì‘:**
1. Noteì˜ ì „ì²´ transcript ì¶”ì¶œ
2. Userì˜ role í™•ì¸
3. GPTì— ì „ì²´ ë§¥ë½ + ì‚¬ìš©ì ì—­í•  + íŠ¹ì • ë¬¸ì¥ ì „ë‹¬
4. ë§¥ë½ ê¸°ë°˜ ë§ì¶¤í˜• ì„¤ëª… ìƒì„±

**ì—­í• ë³„ ì„¤ëª… ì°¨ì´:**
- **student**: ì´ˆë³´ì ìˆ˜ì¤€, ë¹„ìœ ì™€ ì˜ˆì‹œ í¬í•¨
- **teacher**: êµìœ¡í•™ì  ê´€ì , í•™ìƒ ì§€ë„ ë°©ë²• í¬í•¨
- **ê¸°íƒ€**: ì¼ë°˜ì ì¸ ìˆ˜ì¤€ì˜ ì„¤ëª…

**ê¶Œí•œ:**
- ë³¸ì¸ì´ ì‘ì„±í•œ ë…¸íŠ¸
- ê³µê°œ(`isPublic: true`)ëœ ë…¸íŠ¸
- íƒ€ì¸ì˜ ë¹„ê³µê°œ ë…¸íŠ¸ëŠ” 403 Forbidden

---

## ğŸ™ï¸ STT ì „ì²˜ë¦¬ ì‹œìŠ¤í…œ

### ë™ì‘ ì›ë¦¬

**1. KeywordPack ë¡œë“œ ì‹œ:**
```typescript
// pronunciation map ìƒì„±
"ì—ì´í”¼ì•„ì´" â†’ "API"
"ë¦¬ì•¡íŠ¸" â†’ "React"

// synonym map ìƒì„±
"User Experience" â†’ "UX"
"Application Programming Interface" â†’ "API"
"DB" â†’ "ë°ì´í„°ë² ì´ìŠ¤"
```

**2. STT Transcript ìˆ˜ì‹  ì‹œ:**
```typescript
// ì›ë³¸: "ì—ì´í”¼ì•„ì´ë¥¼ ì‚¬ìš©í•´ì„œ User Experienceë¥¼ ê°œì„ í–ˆì–´ìš”"
// 
// ì „ì²˜ë¦¬ ë‹¨ê³„ 1: í•œê¸€ ë°œìŒ ì¹˜í™˜
// â†’ "APIë¥¼ ì‚¬ìš©í•´ì„œ User Experienceë¥¼ ê°œì„ í–ˆì–´ìš”"
//
// ì „ì²˜ë¦¬ ë‹¨ê³„ 2: ë™ì˜ì–´ ì¹˜í™˜
// â†’ "APIë¥¼ ì‚¬ìš©í•´ì„œ UXë¥¼ ê°œì„ í–ˆì–´ìš”"
//
// GPT êµì • (ìµœì¢…)
// â†’ "APIë¥¼ ì‚¬ìš©í•´ì„œ UXë¥¼ ê°œì„ í–ˆì–´ìš”" (í•„ìš”ì‹œ ì¶”ê°€ êµì •)
```

**3. í‚¤ì›Œë“œ ê°ì§€:**
```typescript
// ì „ì²˜ë¦¬ëœ í…ìŠ¤íŠ¸ì—ì„œ í‚¤ì›Œë“œ ê°ì§€
// - í‚¤ì›Œë“œ ì›ì–´ ë§¤ì¹­: "API" ê²€ìƒ‰
// - ë™ì˜ì–´ ë§¤ì¹­: "User Experience" ê²€ìƒ‰ â†’ "UX" ê°ì§€
```

### Recording WebSocket ë³€ê²½ì‚¬í•­

**RecordingSession êµ¬ì¡°:**
```typescript
interface RecordingSession {
  sessionId: string
  noteId: string
  userId: string
  audioChunks: Buffer[]
  startTime: number
  sttConnection: any
  transcriptText: string
  languageCode: string
  keywordPack?: {
    name: string
    description: string
    koreanPronunciation?: string  // ìƒˆë¡œ ì¶”ê°€
    synonyms?: string[]           // ìƒˆë¡œ ì¶”ê°€
  }[]
  keywordDetectionEnabled: boolean
  externalResources?: Array<{...}>
  resourceHintsEnabled: boolean
  pronunciationMap: Map<string, string>  // ìƒˆë¡œ ì¶”ê°€: í•œê¸€ë°œìŒ â†’ ì›ì–´
  synonymMap: Map<string, string>        // ìƒˆë¡œ ì¶”ê°€: ë™ì˜ì–´ â†’ ì›ì–´
}
```

**ì´ë²¤íŠ¸ í”Œë¡œìš°:**
```
1. STTì—ì„œ COMMITTED_TRANSCRIPT ìˆ˜ì‹ 
   â†“
2. preprocessTextWithVocabulary() í˜¸ì¶œ
   - pronunciationMap ì ìš© ("ì—ì´í”¼ì•„ì´" â†’ "API")
   - synonymMap ì ìš© ("User Experience" â†’ "UX")
   â†“
3. ì „ì²˜ë¦¬ëœ í…ìŠ¤íŠ¸ë¡œ í‚¤ì›Œë“œ ê°ì§€
   â†“
4. GPT êµì • (normalizeTextWithGpt)
   â†“
5. í´ë¼ì´ì–¸íŠ¸ì— ì „ì†¡
```

---

## ğŸ”„ ì „ì²´ API ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡

### ì¸ì¦ (Auth)
```
POST   /api/auth/google                  # Google OAuth ë¡œê·¸ì¸
POST   /api/auth/register/continue       # íšŒì›ê°€ì… ì™„ë£Œ (NEW)
```

### ë…¸íŠ¸ (Note)
```
GET    /api/notes                        # ë…¸íŠ¸ ëª©ë¡
GET    /api/notes/:id                    # ë…¸íŠ¸ ìƒì„¸
PATCH  /api/notes/:id                    # ë…¸íŠ¸ ìˆ˜ì •
DELETE /api/notes/:id                    # ë…¸íŠ¸ ì‚­ì œ
POST   /api/notes/:id/ai/explanation     # AI ì„¤ëª… ìƒì„± (NEW)
```

### KeywordPack
```
GET    /api/keywordpack                  # ëª©ë¡ ì¡°íšŒ (ë³€ê²½ë¨: isOwned/isSaved ì¶”ê°€)
GET    /api/keywordpack/:id              # ìƒì„¸ ì¡°íšŒ
POST   /api/keywordpack                  # ìƒì„±
PATCH  /api/keywordpack/:id              # ìˆ˜ì •
DELETE /api/keywordpack/:id              # ì‚­ì œ
POST   /api/keywordpack/:id/keywords     # í‚¤ì›Œë“œ ì¶”ê°€
POST   /api/keywordpack/ai/autocomplete  # AI ìë™ì™„ì„±
POST   /api/keywordpack/ai/autofill      # AI Autofill (ë³€ê²½ë¨: ë°œìŒ/ë™ì˜ì–´ ì¶”ê°€)
POST   /api/keywordpack/:id/cloud-save   # ê³µê°œ íŒ© ì €ì¥ (NEW)
DELETE /api/keywordpack/:id/cloud-save   # ì €ì¥ í•´ì œ (NEW)
```

### ë…¹ìŒ (Recording)
```
POST   /api/recording/session            # ë…¹ìŒ ì„¸ì…˜ ìƒì„±
WS     /api/recording/session/:id        # WebSocket ì—°ê²° (ë³€ê²½ë¨: ì „ì²˜ë¦¬ ì¶”ê°€)
POST   /api/recording/session/stop       # ë…¹ìŒ ì¤‘ì§€
POST   /api/recording/session/cancel     # ë…¹ìŒ ì·¨ì†Œ
GET    /api/recording/record/:noteId     # ë…¹ìŒ íŒŒì¼ ì¡°íšŒ
```

### STT (ì‹¤ì‹œê°„ ìŒì„± ì¸ì‹)
```
WS     /api/stt                          # WebSocket STT (ë³€ê²½ë¨: í”„ë¡¬í”„íŠ¸ ê°œì„ )
```

### ExternalResource
```
GET    /api/externalresource             # ëª©ë¡ ì¡°íšŒ
GET    /api/externalresource/:id         # ìƒì„¸ ì¡°íšŒ
POST   /api/externalresource             # ìƒì„±
PATCH  /api/externalresource/:id         # ìˆ˜ì •
DELETE /api/externalresource/:id         # ì‚­ì œ
```

---

## ğŸ”’ ì¸ì¦ ë¯¸ë“¤ì›¨ì–´ ë³€ê²½ì‚¬í•­

### authMiddleware (ë³€ê²½ë¨)
```typescript
// ê¸°ì¡´: JWT í† í°ë§Œ ê²€ì¦
// ë³€ê²½: JWT í† í° + isActive ì²´í¬

// ì˜ˆì™¸ ê²½ë¡œ: /api/auth/register/continue
// - íšŒì›ê°€ì… ì™„ë£Œ ì „ì´ë¯€ë¡œ isActive=falseì—¬ë„ ì ‘ê·¼ ê°€ëŠ¥

// ê·¸ ì™¸ ëª¨ë“  ê²½ë¡œ:
// - isActive=false â†’ 403 Forbidden
// - ì—ëŸ¬ ë©”ì‹œì§€: "Account not activated. Please complete registration."
```

---

## ğŸ“Š ë°ì´í„° í”Œë¡œìš° ì˜ˆì‹œ

### 1. ì‹ ê·œ ì‚¬ìš©ì ê°€ì… í”Œë¡œìš°
```
1. Google OAuth ë¡œê·¸ì¸
   â†’ POST /api/auth/google
   â†’ User ìƒì„± (isActive: false)
   â†“
2. í´ë¼ì´ì–¸íŠ¸ì—ì„œ isActive í™•ì¸
   â†’ falseì´ë©´ íšŒì›ê°€ì… ì™„ë£Œ í˜ì´ì§€ë¡œ ì´ë™
   â†“
3. ì—­í•  ì„ íƒ ë° ì •ë³´ ì…ë ¥
   â†’ POST /api/auth/register/continue
   â†’ isActive: trueë¡œ ë³€ê²½
   â†“
4. ëª¨ë“  API ì‚¬ìš© ê°€ëŠ¥
```

### 2. KeywordPack ê³µìœ  í”Œë¡œìš°
```
1. ì‚¬ìš©ì A: KeywordPack ìƒì„± (isPublic: false)
   â†“
2. ì‚¬ìš©ì A: isPublicì„ trueë¡œ ë³€ê²½
   â†“
3. ì‚¬ìš©ì B: ê³µê°œ íŒ© ë°œê²¬
   â†’ POST /api/keywordpack/{id}/cloud-save
   â†’ User Bì˜ savedKeywordPackIdsì— ì¶”ê°€
   â†“
4. ì‚¬ìš©ì B: GET /api/keywordpack
   â†’ ìì‹ ì˜ íŒ© + ì €ì¥í•œ ê³µê°œ íŒ© ëª¨ë‘ ì¡°íšŒ
   â†’ isOwned: false, isSaved: trueë¡œ í‘œì‹œ
   â†“
5. ì‚¬ìš©ì A: íŒ© ì—…ë°ì´íŠ¸
   â†’ ì‚¬ìš©ì Bë„ ìë™ìœ¼ë¡œ ìµœì‹  ë²„ì „ ì‚¬ìš©
```

### 3. ë…¹ìŒ ë° ì „ì²˜ë¦¬ í”Œë¡œìš°
```
1. ë…¹ìŒ ì„¸ì…˜ ìƒì„±
   â†’ KeywordPack ì„ íƒ (ë°œìŒ/ë™ì˜ì–´ í¬í•¨)
   â†“
2. WebSocket ì—°ê²°
   â†’ pronunciationMap, synonymMap ìƒì„±
   â†“
3. STT ìŒì„± ì¸ì‹
   â†’ "ì—ì´í”¼ì•„ì´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤"
   â†“
4. ì‹¤ì‹œê°„ ì „ì²˜ë¦¬
   â†’ "APIë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤"
   â†“
5. í‚¤ì›Œë“œ ê°ì§€
   â†’ "API" í‚¤ì›Œë“œ ê°ì§€ë¨
   â†“
6. GPT êµì •
   â†’ "APIë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤" (í•„ìš”ì‹œ ì¶”ê°€ êµì •)
   â†“
7. í´ë¼ì´ì–¸íŠ¸ ì „ì†¡
   â†’ type: "formatted", text: "APIë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤"
```

### 4. AI ì„¤ëª… ìš”ì²­ í”Œë¡œìš°
```
1. ì‚¬ìš©ìê°€ transcriptì—ì„œ ë¬¸ì¥ ì„ íƒ
   â†’ "APIë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤"
   â†“
2. POST /api/notes/:id/ai/explanation
   â†“
3. ì„œë²„:
   - Noteì˜ ì „ì²´ transcript ì¶”ì¶œ
   - Userì˜ role í™•ì¸ ("student")
   - GPTì— ì»¨í…ìŠ¤íŠ¸ ì „ë‹¬
   â†“
4. GPT ì‘ë‹µ:
   - ë§¥ë½: "ë°ì´í„° í†µì‹  ë°©ë²• ì„¤ëª… ë¶€ë¶„"
   - í•µì‹¬: "APIëŠ” ì‹ë‹¹ì˜ ì›¨ì´í„°ì™€ ê°™ìŠµë‹ˆë‹¤..."
   - ë³´ì¶©: "HTTP ìš”ì²­ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ìŠµë‹ˆë‹¤"
   â†“
5. í´ë¼ì´ì–¸íŠ¸ì— êµ¬ì¡°í™”ëœ ì„¤ëª… ë°˜í™˜
```

---

## ğŸ¯ Kotlin ê°œë°œìë¥¼ ìœ„í•œ ì£¼ìš” í¬ì¸íŠ¸

### 1. ì¸ì¦ í”Œë¡œìš° ë³€ê²½
```kotlin
// ê¸°ì¡´
val response = api.googleLogin(idToken)
// ë°”ë¡œ ëª¨ë“  API ì‚¬ìš© ê°€ëŠ¥

// ë³€ê²½ í›„
val response = api.googleLogin(idToken)
if (!response.user.isActive) {
    // íšŒì›ê°€ì… ì™„ë£Œ í™”ë©´ìœ¼ë¡œ ì´ë™
    navigateToRegisterContinue()
} else {
    // ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
    navigateToMain()
}

// íšŒì›ê°€ì… ì™„ë£Œ
api.registerContinue(role = "student", name = "í™ê¸¸ë™")
```

### 2. KeywordPack ë°ì´í„° ëª¨ë¸
```kotlin
data class Keyword(
    val name: String,
    val description: String,
    val koreanPronunciation: String? = null,  // ìƒˆë¡œ ì¶”ê°€
    val synonyms: List<String>? = null        // ìƒˆë¡œ ì¶”ê°€
)

data class KeywordPack(
    val id: String,
    val name: String,
    val keywords: List<Keyword>,
    val isPublic: Boolean,
    val authorId: String,
    val isOwned: Boolean,   // ìƒˆë¡œ ì¶”ê°€
    val isSaved: Boolean    // ìƒˆë¡œ ì¶”ê°€
)
```

### 3. UI êµ¬ë¶„ ë¡œì§
```kotlin
fun renderKeywordPackList(packs: List<KeywordPack>) {
    // ë‚´ê°€ ë§Œë“  íŒ©
    val ownedPacks = packs.filter { it.isOwned }
    
    // ì €ì¥í•œ ê³µê°œ íŒ©
    val savedPacks = packs.filter { it.isSaved }
    
    // UI ë Œë”ë§
    ownedPacks.forEach { pack ->
        // ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ í‘œì‹œ
        // ê³µê°œ/ë¹„ê³µê°œ í† ê¸€ í‘œì‹œ
    }
    
    savedPacks.forEach { pack ->
        // ì½ê¸° ì „ìš©
        // ì €ì¥ í•´ì œ ë²„íŠ¼ë§Œ í‘œì‹œ
    }
}
```

### 4. ì—ëŸ¬ ì²˜ë¦¬
```kotlin
try {
    val response = api.getKeywordPacks()
} catch (e: HttpException) {
    when (e.code()) {
        403 -> {
            if (e.message().contains("not activated")) {
                // íšŒì›ê°€ì… ì™„ë£Œ í•„ìš”
                showActivationDialog()
            } else {
                // ê¶Œí•œ ì—†ìŒ
                showError("ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤")
            }
        }
        // ... ê¸°íƒ€ ì—ëŸ¬ ì²˜ë¦¬
    }
}
```

### 5. WebSocket ë©”ì‹œì§€ íƒ€ì…
```kotlin
sealed class STTMessage {
    data class Partial(val text: String) : STTMessage()
    data class Committed(val text: String) : STTMessage()
    data class Formatted(val text: String) : STTMessage()  // ì „ì²˜ë¦¬ + GPT êµì •
    data class Keywords(val keywords: List<Keyword>) : STTMessage()
    data class Hints(val hints: List<Hint>) : STTMessage()
    data class Error(val error: String) : STTMessage()
}

// ì²˜ë¦¬
when (val message = parseSTTMessage(json)) {
    is STTMessage.Partial -> updatePartialText(message.text)
    is STTMessage.Committed -> updateCommittedText(message.text)
    is STTMessage.Formatted -> {
        // ìµœì¢… êµì •ëœ í…ìŠ¤íŠ¸ (í•œê¸€ë°œìŒâ†’ì›ì–´, ë™ì˜ì–´â†’ì›ì–´, GPT êµì • ì™„ë£Œ)
        updateFormattedText(message.text)
    }
    is STTMessage.Keywords -> showKeywordHints(message.keywords)
    // ...
}
```

---

## ğŸ“ ë³€ê²½ì‚¬í•­ ìš”ì•½ (Kotlin ê°œë°œììš© ì²´í¬ë¦¬ìŠ¤íŠ¸)

### âœ… User ëª¨ë¸
- [ ] `role: String?` í•„ë“œ ì¶”ê°€ (DTO ì—…ë°ì´íŠ¸)
- [ ] `isActive: Boolean` í•„ë“œ ì¶”ê°€ (DTO ì—…ë°ì´íŠ¸)
- [ ] `savedKeywordPackIds: List<String>` í•„ë“œ ì¶”ê°€ (DTO ì—…ë°ì´íŠ¸)

### âœ… ì¸ì¦ í”Œë¡œìš°
- [ ] ë¡œê·¸ì¸ í›„ `isActive` ì²´í¬ ë¡œì§ ì¶”ê°€
- [ ] íšŒì›ê°€ì… ì™„ë£Œ í™”ë©´ êµ¬í˜„
- [ ] `POST /api/auth/register/continue` API ì—°ë™
- [ ] 403 ì—ëŸ¬ ì‹œ "Account not activated" ë©”ì‹œì§€ ì²˜ë¦¬

### âœ… KeywordPack
- [ ] `Keyword` ëª¨ë¸ì— `koreanPronunciation` ì¶”ê°€
- [ ] `Keyword` ëª¨ë¸ì— `synonyms` ì¶”ê°€
- [ ] `KeywordPack` ëª¨ë¸ì— `isOwned` ì¶”ê°€
- [ ] `KeywordPack` ëª¨ë¸ì— `isSaved` ì¶”ê°€
- [ ] Cloud Save API ì—°ë™ (`POST /cloud-save`)
- [ ] Cloud Unsave API ì—°ë™ (`DELETE /cloud-save`)
- [ ] UIì—ì„œ ì†Œìœ /ì €ì¥ íŒ© êµ¬ë¶„ í‘œì‹œ

### âœ… Note
- [ ] AI ì„¤ëª… API ì—°ë™ (`POST /:id/ai/explanation`)
- [ ] ì„¤ëª… í‘œì‹œ UI êµ¬í˜„
- [ ] Markdown í˜•ì‹ ë Œë”ë§ (ë§¥ë½/í•µì‹¬/ë³´ì¶©)

### âœ… STT/Recording
- [ ] `formatted` ë©”ì‹œì§€ íƒ€ì… ì²˜ë¦¬ (ì „ì²˜ë¦¬ ì™„ë£Œëœ í…ìŠ¤íŠ¸)
- [ ] í‚¤ì›Œë“œ ê°ì§€ ì‹œ ë™ì˜ì–´ ë§¤ì¹­ ê³ ë ¤
- [ ] UIì— ì „ì²˜ë¦¬ íš¨ê³¼ í‘œì‹œ (ì„ íƒì‚¬í•­)

---

## ğŸ” í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 1. ì‹ ê·œ ê°€ì… í…ŒìŠ¤íŠ¸
```
1. Google ë¡œê·¸ì¸ â†’ isActive: false í™•ì¸
2. ë‹¤ë¥¸ API í˜¸ì¶œ â†’ 403 ì—ëŸ¬ í™•ì¸
3. /auth/register/continue í˜¸ì¶œ â†’ isActive: true í™•ì¸
4. ë‹¤ë¥¸ API ì •ìƒ í˜¸ì¶œ í™•ì¸
```

### 2. KeywordPack ê³µìœ  í…ŒìŠ¤íŠ¸
```
1. ì‚¬ìš©ì A: KeywordPack ìƒì„± (isPublic: true)
2. ì‚¬ìš©ì B: cloud-save í˜¸ì¶œ
3. ì‚¬ìš©ì B: GET /keywordpack â†’ isSaved: true í™•ì¸
4. ì‚¬ìš©ì A: íŒ© ìˆ˜ì •
5. ì‚¬ìš©ì B: GET /keywordpack/:id â†’ ìµœì‹  ë²„ì „ í™•ì¸
6. ì‚¬ìš©ì B: cloud-unsave í˜¸ì¶œ
7. ì‚¬ìš©ì B: GET /keywordpack â†’ ëª©ë¡ì—ì„œ ì œê±° í™•ì¸
```

### 3. STT ì „ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
```
1. ë°œìŒ/ë™ì˜ì–´ê°€ í¬í•¨ëœ KeywordPack ì„ íƒ
2. ë…¹ìŒ ì‹œì‘
3. "ì—ì´í”¼ì•„ì´" ë°œìŒ â†’ "API"ë¡œ ë³€í™˜ í™•ì¸
4. "User Experience" ë°œìŒ â†’ "UX"ë¡œ ë³€í™˜ í™•ì¸
5. í‚¤ì›Œë“œ ê°ì§€ ë™ì‘ í™•ì¸
```

### 4. AI ì„¤ëª… í…ŒìŠ¤íŠ¸
```
1. ë…¹ìŒ ì™„ë£Œëœ Note ì„ íƒ
2. transcriptì—ì„œ ë¬¸ì¥ ì„ íƒ
3. AI ì„¤ëª… ìš”ì²­
4. roleì— ë”°ë¥¸ ì„¤ëª… ì°¨ì´ í™•ì¸
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

### API Base URL
```
ê°œë°œ: http://localhost:3000/api
í”„ë¡œë•ì…˜: https://api.clari.example.com/api
```

### ì¸ì¦ í—¤ë”
```
Authorization: Bearer <jwt-token>
```

### WebSocket ì¸ì¦
```
ë°©ë²• 1: Header - Authorization: Bearer <token>
ë°©ë²• 2: Query - ?token=<token>
```

### ì—ëŸ¬ ì½”ë“œ
```
400 Bad Request - ì˜ëª»ëœ ìš”ì²­
401 Unauthorized - ì¸ì¦ ì‹¤íŒ¨
403 Forbidden - ê¶Œí•œ ì—†ìŒ (isActive=false í¬í•¨)
404 Not Found - ë¦¬ì†ŒìŠ¤ ì—†ìŒ
500 Internal Server Error - ì„œë²„ ì˜¤ë¥˜
```

---

ì´ ë¬¸ì„œëŠ” 2025-12-30 ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
ì§ˆë¬¸ì´ë‚˜ ì¶”ê°€ ì •ë³´ê°€ í•„ìš”í•œ ê²½ìš° ë°±ì—”ë“œ íŒ€ì— ë¬¸ì˜í•˜ì„¸ìš”.
